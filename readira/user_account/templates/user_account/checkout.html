{% extends "readira/base.html" %}
{% load i18n static %}

{% block content %}
<section class="max-w-2xl mx-auto py-12 px-6">

  <!-- Page title -->
  <h1 class="text-3xl font-bold text-center text-blue-600 mb-8">Checkout</h1>

  <!-- Display of error messages -->
  {% if messages %}
    <ul class="mb-4 space-y-2">
      {% for message in messages %}
        <li class="text-sm text-red-600 bg-red-100 px-4 py-2 rounded">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
  
  <!-- Payment form -->
  <form method="post" class="space-y-6 border border-gray-300 dark:bg-gray-800 p-6 rounded shadow">
    {% csrf_token %}

    <!-- Name -->
    <div>
      <label for="cardholder_name" class="block font-semibold mb-1">Cardholder Name</label>
        <input type="text" name="cardholder_name" placeholder="First Last"  pattern="^[A-Za-z]+(?:\s+[A-Za-z]+)+$"  title="Please enter at least two names (letters only)"  required  class="w-full px-4 py-2 border border-gray-400 rounded-lg bg-white dark:bg-zinc-800 text-black dark:text-white">
    </div>

    <!-- Card number -->
    <div>
      <label for="card_number" class="block font-semibold mb-1">Card Number</label>
        <input type="text" name="card_number"  placeholder="1234567812345678"  inputmode="numeric"  pattern="\d{16}"  maxlength="16"  title="Card number must be exactly 16 digits"  required  autocomplete="cc-number"  oninput="this.value = this.value.replace(/[^0-9]/g, '')"  class="w-full px-4 py-2 border border-gray-400 rounded-lg bg-white dark:bg-zinc-800 text-black dark:text-white">
    </div>


    <!-- Card expiration date and CVV -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label for="card_expiry" class="block font-semibold mb-1">Expiration Date (MM/YY)</label>
        <input type="text"
               name="card_expiry"
               id="card_expiry"
               placeholder="MM/YY"
               maxlength="5"
               required
               class="w-full px-4 py-2 border border-gray-400 rounded-lg bg-white dark:bg-zinc-800 text-black dark:text-white">
      </div>
      <div>
        <label for="card_cvv" class="block font-semibold mb-1">CVV</label>
        <input type="text"
               name="card_cvv"
               placeholder="123"
               inputmode="numeric"
               pattern="[0-9]{3}"
               maxlength="3"
               minlength="3"
               title="CVV must be exactly 3 digits"
               required
               class="w-full px-4 py-2 border border-gray-400 rounded-lg bg-white dark:bg-zinc-800"
               autocomplete="cc-csc"
               oninput="this.value = this.value.replace(/[^0-9]/g, '')">
      </div>
    </div>

    <!-- Total price -->
    <p class="text-xl font-bold text-blue-600 mt-4">Total: {{ total_price }} â‚¬</p>

    <!-- Pay button -->
    <div>
      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-lg font-semibold">
        Pay Now
      </button>
    </div>
  </form>
</section>

<!-- JS script for automatic formatting of MM/YY field in real time -->
<script>
document.getElementById("card_expiry").addEventListener("input", function (e) {
  let val = e.target.value.replace(/[^0-9]/g, '');
  if (val.length >= 3) {
    e.target.value = val.slice(0, 2) + '/' + val.slice(2, 4);
  } else {
    e.target.value = val;
  }
});
</script>
{% endblock %}